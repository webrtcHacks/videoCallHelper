<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Low FrameRate</title>
</head>
<body>
<button>Start</button>
<br>
<span></span>
<br>
<video autoplay muted playsinline></video>
</body>
<script>
    const button = document.querySelector('button');
    const span = document.querySelector('span');
    const videoElem = document.querySelector('video');

    button.onclick = async () => {

        let [{deviceId}] = await navigator.mediaDevices.enumerateDevices().then(devices=>devices.filter(device=>device.label.match("FaceTime")));
        const constraints = {
            video: {
                    frameRate: 1/30,
                    deviceId: deviceId
            }
        }
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        videoElem.srcObject = stream;
        window.stream = stream;

        const [track] = stream.getVideoTracks();
        const processor = new MediaStreamTrackProcessor(track);
        const reader = await processor.readable.getReader();

        async function readFrame() {
            const {value: frame, done} = await reader.read();
            if (frame && !done) {
                const now = new Date();
                span.innerText = ((now - lastTime) / 1000).toString();
                frame.close();
                lastTime = now;
                await readFrame();
            }
        }

        let lastTime = Date.now();
        await readFrame();

    }

</script>
</html>
